<analysis>
The previous AI engineer successfully initiated and developed a full-stack Arabic LMS application, moving from a basic MVP to an AI-powered interactive learning platform. The process involved clarifying product requirements, integrating third-party services like OpenAI GPT-5 and ElevenLabs, and implementing core features such as an interactive alphabet lesson player, JWT and Google OAuth authentication, progress tracking, and gamification. Challenges included fixing bcrypt password issues, adjusting ElevenLabs TTS due to quota limits, and improving pronunciation handling. The engineer systematically addressed feedback, applied hotfixes, and structured the remaining work into distinct phases, ultimately committing to implement Phase 2.2 (Personalization & Memory) in its entirety after initially suggesting a phased approach due to credit budget concerns. The work demonstrates a methodical approach to development, debugging, and user interaction, laying a solid foundation for future enhancements.
</analysis>

<product_requirements>
The goal is to build an AI-powered LMS for teaching Arabic to non-Arabic-speaking Muslims, starting with English speakers. Key features include personalized, adaptive, and gamified learning with AI tutor, 1:1 instructor sessions, group classes, and webinars.

**User Experience & Personalization:** Onboarding (language, age, goal, time, style) leading to AI-generated curriculum. Personalized dashboard with lessons, progress, streak, and adaptive difficulty.
**Frontend Features:** Home/Dashboard, interactive Lessons Player (listening, writing, speaking), AI Tutor Chat, Voice Practice with pronunciation feedback, Gamification (badges, levels, XP, Word of the Day), Live Learning (booking 1:1, group classes, webinars, calendar), Payments.
**Curriculum Builder (Admin/Teacher):** Tracks (Alphabet, Vocabulary, Grammar, Reading, Writing, Listening & Speaking, Culture & History), Content Types (Video, Audio, Flashcards, Quizzes, AI drills), Drag-and-drop lesson builder, level tagging.
**AI Integration:** Conversational AI Tutor (GPT-5, grammar, questions, encouragement), Adaptive Learning Engine (performance-based difficulty, review quizzes, tutor suggestions), Pronunciation Engine (speech-to-text, phonetic hints), Memory Layer (progress, struggles, preferences).
**Monetization & Access Control:** Free Tier, Paid Subscription (unlimited, AI, discounts), Pay-per-Session, Family Plan.
**Admin Dashboard:** User, Tutor, Analytics, Curriculum, Payment Management.
**Technical Requirements:** Mobile-first, Cloud DB, WebRTC/Zoom, AI models (OpenAI GPT-5), Secure Auth (OAuth/email/password).
**Engagement:** Push notifications, streak tracker, leaderboards, AI milestones.

For MVP, the user prioritized **Interactive lesson player with basic Arabic alphabet learning**, using **OpenAI GPT-5**, **JWT with username/password & Google social login**, and **Stripe & PayPal integration**.
</product_requirements>

<key_technical_concepts>
- **Full-stack Architecture:** React (frontend), FastAPI (backend), MongoDB (database).
- **Authentication:** JWT with email/password and Google OAuth.
- **AI/LLM Integration:** OpenAI GPT-5 via  library for AI Tutor.
- **Text-to-Speech (TTS):** ElevenLabs API and browser  fallback.
- **Voice Recognition:** Python's  library.
- **UI Framework:** Shadcn UI with Tailwind CSS.
- **Data Serialization:** UUIDs for MongoDB IDs, ISO strings for DateTime.
- **Deployment:** Kubernetes with Supervisor for service management.
</key_technical_concepts>

<code_architecture>
The application is structured into  for FastAPI and  for React, along with  and .



-   ****: This is the core backend FastAPI application.
    *   **Importance**: Handles all API routes, database interactions, authentication (JWT, Google OAuth), ElevenLabs/browser TTS, SpeechRecognition, and AI Tutor (GPT-5) logic.
    *   **Changes**: Initially set up with basic routes, then extended for lessons, progress, authentication. Later modified for ElevenLabs error handling, JWT secret length, passlib context, and comprehensive AI Tutor (Phase 2.1) including chat history persistence and context injection. Most recently, it will be updated to implement the Phase 2.2 memory model, adaptive recommendations, and enhanced tutor context.
-   ****: Stores backend environment variables like , , , and /.
    *   **Importance**: Critical for secure configuration and external service keys.
    *   **Changes**: Added , , , .
-   ****: The main React component.
    *   **Importance**: Contains the primary application layout, routing, and integrates various components like the lesson player, authentication forms, and the AI Tutor chat.
    *   **Changes**: Evolved from a basic setup to include the interactive alphabet lesson player, navigation, progress display, authentication UI (sign-up/login/Google OAuth), AI Tutor chat interface, voice recording functionality, and mobile responsiveness fixes. It will be updated for Phase 2.2 to include the /review route, dashboard notifications, and potentially integrate Islamic context boosters.
-   ****: Stores frontend environment variables, primarily .
    *   **Importance**: Connects the frontend to the backend API.
    *   **Changes**:  is configured for production.
-   ****: Python dependencies.
    *   **Importance**: Manages backend library versions.
    *   **Changes**: Added , , , and .
-   **, , **: Documentation of changes and fixes.
    *   **Importance**: Provides a historical record of development and bug fixes.
    *   **Changes**: Created during hotfix and phase completion summaries.
-   **MongoDB Data Models**:
    *   **Lessons**: Stores Arabic alphabet letters, transliteration, pronunciation (audio URLs), example words.
    *   **User Progress**: Tracks completion status, XP, and scores per letter for logged-in users.
    *   **AI Chat Session**: Persists the last 20 exchanges for the AI Tutor.
    *   **User Learning Memory (Phase 2.2)**: New collection to store , , , , , , , .
</code_architecture>

<pending_tasks>
- **Phase 3 - Payment & Subscription System**: Stripe + PayPal integration, subscription management, pay-per-session, family plans, usage analytics.
- **Phase 4 - Live Learning & Community**: 1:1 tutor booking, group classes, WebRTC integration, community forum, teacher dashboard.
- **Phase 5 - Advanced Curriculum**: Grammar modules, vocabulary building, reading/writing practice, cultural context.
- **Phase 6 - Advanced Features**: Advanced speech recognition, adaptive learning engine, gamification 2.0, multi-language UI, offline mode.
- **Out of Scope for Phase 2.2**: Detailed phoneme-level scoring, push notifications/email, leaderboards/competitions, payments or tutor marketplace.
</pending_tasks>

<current_work>
The AI engineer has successfully completed Phase 1 (Interactive Lesson Player with Auth, Progress, Gamification) and a set of hotfixes.

**Completed work (Phase 1 + Hotfixes):**
-   **Arabic alphabet learning module** with 28 letters, navigation, and a progress bar.
-   **Audio playback** for each letter, initially with ElevenLabs and later refined with a robust browser  fallback due to ElevenLabs quota issues.
-   **Interactive quiz** (Click the letter you hear) with completion gating (minimum 80% score threshold) and Retry Quiz flow.
-   **Basic gamification**: XP and progress bar display, completion badge for all 28 letters.
-   **Backend REST endpoints**: , , .
-   **User authentication**: JWT with username/password, and Google OAuth login with persistent sessions (7-day TTL with rolling refresh).
-   **AI Tutor Chat (Phase 2.1 MVP)**:
    -   Floating chat drawer UI (Ustaz Ahmed - AI Arabic Tutor).
    -    endpoint injecting current lesson context.
    -   Persists last 20 exchanges per user in MongoDB.
    -   Context-awareness for current lesson, suggesting review for low scores.
    -   Islamic context integration (Quranic examples for letters/words).
    -   Basic voice practice: recording audio and sending to backend for AI text transcription and simple pass/fail feedback, enhanced with AI-powered tips.
    -   AI Tutor now includes a voice recording option to speak with him.
-   **Minimalist, responsive design** with a neutral educational color palette, Arabic font rendering, and mobile-first layout (fixed header/footer issues, touch targets).
-   **Basic unit tests** and a  for fixes.

**Current focus:** The AI engineer is now implementing **Phase 2.2 - Personalization & Memory (Full Implementation)**. This involves:
1.  **Learner Memory Model (MongoDB)**:  collection storing strengths, weaknesses, review queue, streaks, quiz scores, and AI notes.
2.  **Adaptive Recommendation Service**:  endpoint with logic to push units to  based on low scores, timeouts, or streak breaks.
3.  **Tutor Context Upgrade**: Extending  to inject top weaknesses, primary recommendations, and last quiz trend; AI will make targeted first suggestions.
4.  **Review Mode (Lightweight UI)**: New  route with cards for queued items, mini-quizzes, and pronunciation attempts. Updates memory and queue upon completion.
5.  **Islamic Context Boosters**: Adding optional metadata (, ) to units for AI tutor replies and review cards.
6.  **Notifications (MVP hooks)**:  endpoint returning simple strings to be displayed as dismissible banners on the Dashboard.
7.  **Telemetry & Admin Micro-View**:  for stats like total users with queue, avg queue length, avg score, retry rate, TTS error rate.

The engineer is currently in the process of implementing the entire Phase 2.2, having just confirmed to proceed with Option A - Full Implementation.
</current_work>

<optional_next_step>
Implement **Option A - Full Implementation** of Phase 2.2, focusing on the Learner Memory Model and Adaptive Recommendation Service.
</optional_next_step>
